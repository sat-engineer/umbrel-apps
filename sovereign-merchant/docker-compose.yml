version: "3.7"

services:
  app_proxy:
    environment:
      APP_HOST: sovereign-merchant_web_1
      APP_PORT: 4001

  web:
    image: satengineer/sovereign-merchant:v0.0.1@sha256:a295c0b5f1493569672b0c0785406e9f3eaaca3ddecc48f1c9c740030f9bdbe2
    user: "1000:1000"
    restart: on-failure
    stop_grace_period: 1m
    volumes:
      # Mount data directory for SQLite database persistence
      - ${APP_DATA_DIR}:/data
    environment:
      # Server configuration
      PORT: 4001
      HOST: 0.0.0.0
      NODE_ENV: production

      # Database configuration
      DATABASE_PATH: /data/config.db

      # BTCPayServer integration (will be configured via Umbrel variables)
      # BTCEXP_BITCOIND_HOST, etc. will be added when BTCPay is integrated

      # App configuration for Umbrel
      APP_HIDDEN_SERVICE: $APP_HIDDEN_SERVICE
      APP_PASSWORD: $APP_PASSWORD
